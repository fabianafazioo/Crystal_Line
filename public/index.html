<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>âœ¦ Crystalline â€” Elemental Knowledge Puzzle</title>
<link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@400;700;900&family=Crimson+Pro:ital,wght@0,300;0,400;0,600;1,400&family=Rajdhani:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root{
  --fire:#ff4e1a;--water:#00c8ff;--ice:#a8f0ff;--lightning:#ffe033;
  --earth:#7fff5e;--shadow:#cc44ff;--rune:#ffd700;
  --bg:#07040f;--panel:rgba(255,255,255,0.04);
  --border:rgba(255,255,255,0.10);--text:#f0e8ff;--dim:rgba(240,232,255,0.45);
}
*{margin:0;padding:0;box-sizing:border-box;}
html{scroll-behavior:smooth;}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   TOPIC SELECT â€” scrolls like a normal webpage
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
body{background:var(--bg);color:var(--text);font-family:'Crimson Pro',serif;}
#bg-canvas{position:fixed;inset:0;z-index:0;pointer-events:none;}

#topic-screen{
  position:relative;z-index:10;
  min-height:100vh;width:100%;
  display:flex;flex-direction:column;align-items:center;
  padding:40px 16px 80px;
  overflow-y:auto;-webkit-overflow-scrolling:touch;
}
#topic-screen.hidden{display:none;}
.topic-card{
  max-width:700px;width:100%;text-align:center;
  padding:40px 28px;
  background:rgba(10,5,24,.75);border:1px solid rgba(255,255,255,.07);
  border-radius:24px;backdrop-filter:blur(12px);
}
#topic-screen h1{
  font-family:'Cinzel Decorative',serif;font-size:clamp(1.6rem,5vw,2.8rem);
  font-weight:900;letter-spacing:.1em;
  background:linear-gradient(135deg,#ffd700,#ff9a00,#e0c3fc,#96f7d2);
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;
  filter:drop-shadow(0 0 20px rgba(255,215,0,.5));margin-bottom:6px;
}
.subtitle{font-family:'Rajdhani',sans-serif;font-size:.88rem;color:var(--dim);letter-spacing:.25em;text-transform:uppercase;margin-bottom:22px;}
.how{font-size:.92rem;color:#b8a9d0;line-height:1.9;margin-bottom:26px;max-width:520px;margin-left:auto;margin-right:auto;}
.how strong{color:#ffd700;}
.badge{display:inline-block;background:rgba(255,215,0,.12);border:1px solid rgba(255,215,0,.3);border-radius:6px;padding:1px 7px;font-family:'Rajdhani',sans-serif;font-size:.74rem;color:#ffd700;letter-spacing:.1em;}

.topic-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(128px,1fr));gap:10px;margin-bottom:26px;}
.topic-btn{background:var(--panel);border:1px solid var(--border);border-radius:16px;padding:16px 8px;cursor:pointer;transition:all .25s;display:flex;flex-direction:column;align-items:center;gap:6px;}
.topic-btn:hover{border-color:rgba(255,215,0,.5);background:rgba(255,215,0,.06);transform:translateY(-3px);box-shadow:0 8px 24px rgba(255,215,0,.15);}
.topic-btn.active{border-color:#ffd700;background:rgba(255,215,0,.12);box-shadow:0 0 20px rgba(255,215,0,.3);}
.topic-icon{font-size:1.8rem;}.topic-name{font-family:'Rajdhani',sans-serif;font-weight:700;font-size:.78rem;letter-spacing:.1em;text-transform:uppercase;}
.topic-desc{font-size:.64rem;color:var(--dim);line-height:1.4;text-align:center;}

/* Scoring guide on home screen */
.score-guide{margin-top:28px;background:rgba(255,255,255,.025);border:1px solid rgba(255,255,255,.07);border-radius:16px;padding:18px 20px;text-align:left;}
.score-guide h3{font-family:'Rajdhani',sans-serif;font-size:.65rem;letter-spacing:.22em;text-transform:uppercase;color:var(--dim);text-align:center;margin-bottom:14px;}
.sg-cols{display:grid;grid-template-columns:1fr 1fr;gap:6px 18px;}
.sg-row{display:flex;align-items:center;justify-content:space-between;gap:8px;font-family:'Rajdhani',sans-serif;font-size:.72rem;padding:3px 0;border-bottom:1px solid rgba(255,255,255,.04);}
.sg-left{display:flex;align-items:center;gap:6px;color:var(--dim);}
.sg-dot{width:10px;height:10px;border-radius:50%;flex-shrink:0;}
.sg-val{color:#e8c6ff;font-weight:600;white-space:nowrap;}
.sg-val.gold{color:#ffd700;}
.sg-val.red{color:#ff4e1a;}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   BUTTONS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.btn{display:inline-block;padding:12px 30px;border-radius:999px;border:none;cursor:pointer;font-family:'Rajdhani',sans-serif;font-weight:700;font-size:.86rem;letter-spacing:.15em;text-transform:uppercase;transition:transform .2s,box-shadow .2s,filter .2s;}
.btn:hover{transform:scale(1.05);filter:brightness(1.12);}
.btn:active{transform:scale(.97);}
.btn:disabled{opacity:.45;pointer-events:none;}
.btn-gold{background:linear-gradient(135deg,#b8860b,#ffd700,#b8860b);color:#1a1000;box-shadow:0 0 24px rgba(255,215,0,.4);}
.btn-purple{background:linear-gradient(135deg,#7c3aed,#a855f7);color:#fff;box-shadow:0 0 20px rgba(124,58,237,.5);}
.btn-ghost{background:transparent;border:1px solid rgba(167,139,250,.4);color:#c4b5fd;padding:10px 20px;}
.btn-red{background:linear-gradient(135deg,#7f1d1d,#ef4444);color:#fff;box-shadow:0 0 14px rgba(239,68,68,.35);}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   TOP BAR â€” fixed strip during gameplay
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#top-bar{
  position:fixed;top:0;left:0;right:0;z-index:90;
  display:none;align-items:center;justify-content:space-between;
  padding:7px 14px;gap:8px;
  background:rgba(7,4,15,.9);backdrop-filter:blur(14px);
  border-bottom:1px solid rgba(255,255,255,.07);
}
#top-bar.visible{display:flex;}
.topbar-btn{
  display:flex;align-items:center;gap:5px;
  background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.11);
  border-radius:10px;padding:6px 12px;cursor:pointer;
  font-family:'Rajdhani',sans-serif;font-weight:700;font-size:.74rem;
  letter-spacing:.12em;text-transform:uppercase;color:var(--dim);
  transition:background .2s,border-color .2s,color .2s;white-space:nowrap;
}
#home-btn:hover{background:rgba(239,68,68,.1);border-color:rgba(239,68,68,.35);color:#f87171;}
#pause-btn:hover{background:rgba(255,215,0,.08);border-color:rgba(255,215,0,.3);color:#ffd700;}
/* info button â€” mobile only */
#info-btn{display:none;}
@media(max-width:720px){#info-btn{display:flex;}}
#info-btn:hover{background:rgba(150,247,210,.08);border-color:rgba(150,247,210,.3);color:#96f7d2;}
.topbar-center{flex:1;display:flex;justify-content:center;}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   INFO DRAWER â€” slides down on mobile
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#info-drawer{
  position:fixed;top:42px;left:0;right:0;z-index:85;
  background:rgba(10,5,24,.97);backdrop-filter:blur(20px);
  border-bottom:1px solid rgba(255,255,255,.09);
  padding:14px 18px 18px;
  max-height:75vh;overflow-y:auto;-webkit-overflow-scrolling:touch;
  transform:translateY(-105%);transition:transform .3s ease;
}
#info-drawer.open{transform:translateY(0);}
#info-drawer h3{font-family:'Rajdhani',sans-serif;font-size:.65rem;letter-spacing:.22em;text-transform:uppercase;color:var(--dim);text-align:center;margin-bottom:12px;}
.dr-section{margin-bottom:14px;}
.dr-head{font-family:'Rajdhani',sans-serif;font-size:.6rem;letter-spacing:.18em;text-transform:uppercase;color:#ffd700;margin-bottom:7px;border-bottom:1px solid rgba(255,215,0,.15);padding-bottom:4px;}
.dr-row{display:flex;align-items:center;justify-content:space-between;padding:4px 0;border-bottom:1px solid rgba(255,255,255,.04);font-family:'Rajdhani',sans-serif;font-size:.74rem;}
.dr-row:last-child{border-bottom:none;}
.dr-left{display:flex;align-items:center;gap:7px;color:var(--dim);}
.dr-dot{width:10px;height:10px;border-radius:50%;flex-shrink:0;}
.dr-val{color:#e8c6ff;font-weight:600;}
.dr-val.gold{color:#ffd700;}.dr-val.red{color:#ff4e1a;}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   GAME SCREEN
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#game-screen{
  position:fixed;inset:0;z-index:20;
  display:flex;flex-direction:column;align-items:center;
  background:var(--bg);overflow-y:auto;-webkit-overflow-scrolling:touch;
}
#game-screen.hidden{display:none;}
#app{
  display:flex;flex-direction:column;align-items:center;
  gap:6px;width:100%;max-width:990px;
  padding:52px 8px 20px;/* top pad = top-bar height */
}

header{text-align:center;user-select:none;width:100%;}
header h1{font-family:'Cinzel Decorative',serif;font-size:clamp(.95rem,2.2vw,1.6rem);font-weight:900;letter-spacing:.12em;
  background:linear-gradient(135deg,#ffd700,#ff9a00,#e0c3fc,#96f7d2);
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;
  filter:drop-shadow(0 0 14px rgba(255,215,0,.5));}
#topic-badge{display:inline-flex;align-items:center;gap:5px;margin-top:2px;font-family:'Rajdhani',sans-serif;font-size:.63rem;letter-spacing:.2em;text-transform:uppercase;color:#ffd700;background:rgba(255,215,0,.08);border:1px solid rgba(255,215,0,.25);border-radius:999px;padding:2px 10px;}
#ai-badge{display:inline-flex;align-items:center;gap:4px;margin-left:6px;font-family:'Rajdhani',sans-serif;font-size:.59rem;letter-spacing:.12em;color:#96f7d2;background:rgba(150,247,210,.08);border:1px solid rgba(150,247,210,.25);border-radius:999px;padding:2px 9px;}
.ai-dot{width:6px;height:6px;border-radius:50%;background:#96f7d2;animation:aipulse 2s infinite;}
@keyframes aipulse{0%,100%{opacity:1;box-shadow:0 0 4px #96f7d2;}50%{opacity:.3;box-shadow:none;}}

/* HUD */
#hud{display:flex;gap:7px;align-items:center;justify-content:center;flex-wrap:wrap;width:100%;}
.hud-card{background:var(--panel);border:1px solid var(--border);border-radius:10px;padding:4px 12px;display:flex;flex-direction:column;align-items:center;min-width:60px;backdrop-filter:blur(10px);}
.hud-label{font-family:'Rajdhani',sans-serif;font-size:.52rem;letter-spacing:.22em;text-transform:uppercase;color:var(--dim);}
.hud-value{font-family:'Cinzel Decorative',serif;font-size:1rem;font-weight:700;color:#e8c6ff;line-height:1;transition:transform .15s;}
.hud-value.pop{transform:scale(1.35);color:#ffd700;}
#combo-display{font-family:'Rajdhani',sans-serif;font-size:.74rem;letter-spacing:.14em;padding:3px 12px;border-radius:999px;background:linear-gradient(90deg,rgba(255,78,26,.2),rgba(167,139,250,.2));border:1px solid rgba(255,224,51,.3);color:#ffe066;opacity:0;transition:opacity .3s,transform .3s;transform:translateY(4px);}
#combo-display.visible{opacity:1;transform:translateY(0);}

/* Status bar */
#status-bar{display:flex;gap:8px;align-items:center;justify-content:center;min-height:24px;flex-wrap:wrap;}
#rune-alert{display:flex;align-items:center;gap:6px;padding:3px 13px;border-radius:999px;background:linear-gradient(90deg,rgba(255,215,0,.12),rgba(255,150,0,.08));border:1px solid rgba(255,215,0,.35);font-family:'Rajdhani',sans-serif;font-size:.7rem;letter-spacing:.08em;color:#ffd700;opacity:0;transition:opacity .4s;pointer-events:none;}
#rune-alert.visible{opacity:1;}
.pulse{width:7px;height:7px;border-radius:50%;background:#ffd700;box-shadow:0 0 6px #ffd700;animation:blink .8s infinite;}
@keyframes blink{0%,100%{opacity:1;}50%{opacity:.2;}}
#ai-loading{display:flex;align-items:center;gap:6px;padding:3px 13px;border-radius:999px;background:rgba(150,247,210,.07);border:1px solid rgba(150,247,210,.25);font-family:'Rajdhani',sans-serif;font-size:.7rem;letter-spacing:.1em;color:#96f7d2;opacity:0;transition:opacity .4s;pointer-events:none;}
#ai-loading.visible{opacity:1;}
.spin{width:9px;height:9px;border:2px solid rgba(150,247,210,.3);border-top-color:#96f7d2;border-radius:50%;animation:spin .7s linear infinite;}
@keyframes spin{to{transform:rotate(360deg);}}

/* Moves bar */
#moves-bar-wrap{max-width:520px;width:100%;}
#moves-label{display:flex;justify-content:space-between;font-family:'Rajdhani',sans-serif;font-size:.57rem;color:var(--dim);letter-spacing:.14em;text-transform:uppercase;margin-bottom:3px;}
#moves-bar-bg{width:100%;height:6px;background:rgba(255,255,255,.06);border-radius:99px;overflow:hidden;}
#moves-bar-fill{height:100%;border-radius:99px;background:linear-gradient(90deg,#a78bfa,#60d0ff);box-shadow:0 0 8px rgba(96,208,255,.6);transition:width .4s,background .4s;}

/* Game area */
#game-area{display:flex;gap:10px;align-items:flex-start;justify-content:center;width:100%;}
.side-panel{background:var(--panel);border:1px solid var(--border);border-radius:14px;padding:10px 9px;width:130px;flex-shrink:0;backdrop-filter:blur(10px);display:flex;flex-direction:column;gap:7px;}
.side-panel h3{font-family:'Rajdhani',sans-serif;font-size:.54rem;letter-spacing:.2em;text-transform:uppercase;color:var(--dim);text-align:center;border-bottom:1px solid var(--border);padding-bottom:4px;margin-bottom:2px;}
.elem-row{display:flex;align-items:center;justify-content:space-between;font-family:'Rajdhani',sans-serif;font-size:.63rem;color:var(--dim);}
.elem-left{display:flex;align-items:center;gap:5px;}
.elem-dot{width:10px;height:10px;border-radius:50%;flex-shrink:0;}
.elem-pts{color:#c4b5fd;font-weight:600;font-size:.6rem;}
.stat-row{display:flex;justify-content:space-between;align-items:center;}
.stat-key{font-family:'Rajdhani',sans-serif;font-size:.56rem;color:var(--dim);}
.stat-val{font-family:'Rajdhani',sans-serif;font-size:.7rem;color:#c4b5fd;font-weight:600;}
.stat-val.gold{color:#ffd700;}
#rune-bar-bg{width:100%;height:4px;background:rgba(255,215,0,.1);border-radius:99px;overflow:hidden;}
#rune-bar-fill{height:100%;border-radius:99px;background:linear-gradient(90deg,#b8860b,#ffd700);transition:width .5s;}

/* Canvas */
#canvas-wrapper{position:relative;flex-shrink:0;border-radius:16px;overflow:hidden;
  box-shadow:0 0 0 1px rgba(255,255,255,.07),0 0 50px rgba(100,60,180,.35),inset 0 0 40px rgba(0,0,0,.5);}
#canvas-wrapper::before{content:'';position:absolute;inset:0;border-radius:16px;border:1px solid rgba(255,215,0,.15);pointer-events:none;z-index:20;}
#game-canvas{display:block;cursor:pointer;border-radius:16px;}
#particle-canvas{position:absolute;inset:0;pointer-events:none;border-radius:16px;z-index:15;}
#canvas-paused{position:absolute;inset:0;border-radius:16px;background:rgba(7,4,15,.72);z-index:25;display:none;align-items:center;justify-content:center;flex-direction:column;gap:8px;backdrop-filter:blur(6px);}
#canvas-paused.visible{display:flex;}
#canvas-paused p{font-family:'Cinzel Decorative',serif;font-size:1.3rem;color:#ffd700;filter:drop-shadow(0 0 12px rgba(255,215,0,.6));}
#canvas-paused span{font-family:'Rajdhani',sans-serif;font-size:.72rem;color:var(--dim);letter-spacing:.2em;text-transform:uppercase;}

/* Level strip */
#level-strip{display:flex;gap:10px;align-items:center;justify-content:center;font-family:'Rajdhani',sans-serif;font-size:.62rem;color:var(--dim);letter-spacing:.16em;text-transform:uppercase;flex-wrap:wrap;}
#level-strip span{color:#c4b5fd;font-weight:600;}
#level-strip .gold{color:#ffd700;}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   QUESTION OVERLAY
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#question-overlay{position:fixed;inset:0;z-index:200;display:flex;align-items:center;justify-content:center;background:rgba(7,4,15,.94);backdrop-filter:blur(22px);opacity:0;pointer-events:none;transition:opacity .35s;}
#question-overlay.active{opacity:1;pointer-events:all;}
.q-card{background:linear-gradient(135deg,rgba(30,12,60,.99),rgba(10,6,20,1));border:1px solid rgba(255,215,0,.3);border-radius:22px;padding:28px 34px;text-align:center;max-width:500px;width:93%;max-height:90vh;overflow-y:auto;box-shadow:0 0 80px rgba(255,215,0,.2),0 0 160px rgba(100,60,180,.3);transform:scale(.92);transition:transform .35s;}
#question-overlay.active .q-card{transform:scale(1);}
.q-rune-display{width:64px;height:64px;border-radius:50%;margin:0 auto 12px;display:flex;align-items:center;justify-content:center;font-family:'Rajdhani',sans-serif;font-size:1.2rem;font-weight:700;color:#1a1000;background:radial-gradient(circle at 35% 30%,#ffe88a,#ffd700 55%,#b8860b);box-shadow:0 0 30px rgba(255,215,0,.6);}
.q-card h3{font-family:'Cinzel Decorative',serif;font-size:.9rem;letter-spacing:.1em;color:#ffd700;margin-bottom:4px;}
.q-meta{display:flex;align-items:center;justify-content:center;gap:7px;margin-bottom:12px;flex-wrap:wrap;}
.q-topic-badge{font-family:'Rajdhani',sans-serif;font-size:.6rem;letter-spacing:.16em;text-transform:uppercase;color:var(--dim);}
.q-diff-badge{font-family:'Rajdhani',sans-serif;font-size:.6rem;letter-spacing:.1em;padding:2px 8px;border-radius:999px;border:1px solid;font-weight:600;}
.q-timer-bar-bg{width:100%;height:5px;background:rgba(255,255,255,.08);border-radius:99px;overflow:hidden;margin-bottom:12px;}
.q-timer-bar{height:100%;border-radius:99px;background:linear-gradient(90deg,#ffd700,#ff9a00);transition:width .1s linear;}
.q-question{font-size:1rem;color:var(--text);line-height:1.75;margin-bottom:18px;font-style:italic;}
.q-choices{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:12px;}
@media(max-width:480px){.q-choices{grid-template-columns:1fr;}}
.q-choice{background:rgba(255,255,255,.04);border:1px solid var(--border);border-radius:10px;padding:10px 8px;cursor:pointer;font-family:'Rajdhani',sans-serif;font-size:.8rem;font-weight:600;letter-spacing:.04em;color:var(--text);transition:all .2s;text-align:left;line-height:1.4;}
.q-choice:hover:not(:disabled){border-color:rgba(255,215,0,.4);background:rgba(255,215,0,.07);color:#ffd700;}
.q-choice.correct{border-color:#7fff5e!important;background:rgba(127,255,94,.12)!important;color:#7fff5e!important;pointer-events:none;}
.q-choice.wrong{border-color:#ff4e1a!important;background:rgba(255,78,26,.1)!important;color:#ff4e1a!important;pointer-events:none;}
.q-choice.reveal{border-color:#7fff5e!important;background:rgba(127,255,94,.07)!important;color:#7fff5e!important;pointer-events:none;}
.q-feedback{font-family:'Rajdhani',sans-serif;font-size:.78rem;letter-spacing:.1em;min-height:18px;margin-bottom:5px;}
.q-feedback.good{color:#7fff5e;}.q-feedback.bad{color:#ff4e1a;}
.q-explanation{font-size:.74rem;color:var(--dim);font-style:italic;min-height:16px;line-height:1.5;margin-bottom:7px;}
.q-stakes{font-family:'Rajdhani',sans-serif;font-size:.64rem;color:var(--dim);}
.q-stakes .good{color:#7fff5e;}.q-stakes .bad{color:#ff4e1a;}
.q-source{font-family:'Rajdhani',sans-serif;font-size:.56rem;color:rgba(150,247,210,.4);margin-top:5px;letter-spacing:.1em;}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   OVERLAYS (level complete, game over, confirm)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.overlay{position:fixed;inset:0;z-index:100;display:flex;align-items:center;justify-content:center;background:rgba(5,2,14,.88);backdrop-filter:blur(16px);opacity:0;pointer-events:none;transition:opacity .4s;}
.overlay.active{opacity:1;pointer-events:all;}
.overlay-card{background:linear-gradient(135deg,rgba(30,12,60,.95),rgba(10,6,20,.98));border:1px solid rgba(167,139,250,.3);border-radius:22px;padding:32px 36px;text-align:center;max-width:420px;width:90%;max-height:90vh;overflow-y:auto;box-shadow:0 0 80px rgba(100,60,180,.5);transform:translateY(20px);transition:transform .4s;}
.overlay.active .overlay-card{transform:translateY(0);}
.overlay-card h2{font-family:'Cinzel Decorative',serif;font-size:1.5rem;background:linear-gradient(135deg,#ffd700,#ff9a00,#e0c3fc);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;margin-bottom:7px;}
.overlay-card p{color:var(--dim);font-size:.84rem;line-height:1.75;margin-bottom:6px;}
.big-score{font-family:'Cinzel Decorative',serif;font-size:2.4rem;color:#ffd700;filter:drop-shadow(0 0 18px rgba(255,215,0,.6));margin:10px 0;display:block;}
.stars-row{display:flex;justify-content:center;gap:8px;margin:8px 0;}
.star{font-size:1.7rem;opacity:.2;transition:opacity .3s,transform .3s;transition-delay:var(--d,0s);}
.star.lit{opacity:1;transform:scale(1.2) rotate(8deg);}
.score-breakdown{display:flex;flex-direction:column;gap:4px;margin:10px 0;font-family:'Rajdhani',sans-serif;font-size:.76rem;}
.breakdown-row{display:flex;justify-content:space-between;padding:4px 10px;border-radius:7px;background:rgba(255,255,255,.03);}
.breakdown-row .label{color:var(--dim);}.breakdown-row .val{color:#ffd700;font-weight:600;}
.overlay-btns{display:flex;flex-wrap:wrap;gap:8px;justify-content:center;margin-top:14px;}

/* Pause overlay â€” vertically stacked buttons, clearly separated */
#pause-overlay{position:fixed;inset:0;z-index:80;display:flex;align-items:center;justify-content:center;background:rgba(7,4,15,.86);backdrop-filter:blur(20px);opacity:0;pointer-events:none;transition:opacity .3s;}
#pause-overlay.active{opacity:1;pointer-events:all;}
.pause-card{background:linear-gradient(135deg,rgba(30,12,60,.98),rgba(10,6,20,1));border:1px solid rgba(167,139,250,.3);border-radius:22px;padding:36px 44px;text-align:center;max-width:340px;width:90%;box-shadow:0 0 60px rgba(100,60,180,.4);}
.pause-card h2{font-family:'Cinzel Decorative',serif;font-size:1.5rem;background:linear-gradient(135deg,#ffd700,#e0c3fc);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;margin-bottom:8px;}
.pause-card p{color:var(--dim);font-size:.82rem;line-height:1.7;margin-bottom:26px;}
.pause-btns{display:flex;flex-direction:column;gap:10px;align-items:stretch;}
.pause-divider{height:1px;background:rgba(255,255,255,.07);margin:4px 0;}

/* Score popup */
.score-popup{position:fixed;pointer-events:none;font-family:'Rajdhani',sans-serif;font-weight:700;font-size:1rem;text-shadow:0 0 10px currentColor;animation:floatUp 1.1s forwards ease-out;z-index:300;white-space:nowrap;}
@keyframes floatUp{0%{opacity:1;transform:translateY(0) scale(1);}60%{opacity:1;transform:translateY(-40px) scale(1.1);}100%{opacity:0;transform:translateY(-70px) scale(.9);}}

@media(max-width:720px){.side-panel{display:none;}#game-area{flex-direction:column;align-items:center;}}
</style>
</head>
<body>
<canvas id="bg-canvas"></canvas>

<!-- â”€â”€ TOP BAR â”€â”€ -->
<div id="top-bar">
  <button class="topbar-btn" id="home-btn" onclick="confirmGoHome()">ğŸ  Home</button>
  <div class="topbar-center">
    <button class="topbar-btn" id="info-btn" onclick="toggleInfoDrawer()">ğŸ“Š Info</button>
  </div>
  <button class="topbar-btn" id="pause-btn" onclick="togglePause()">
    <span id="pause-icon">â¸</span><span id="pause-label">Pause</span>
  </button>
</div>

<!-- â”€â”€ INFO DRAWER (mobile scoring guide) â”€â”€ -->
<div id="info-drawer">
  <h3>âœ¦ Scoring Guide</h3>
  <div class="dr-section">
    <div class="dr-head">Gem Matches</div>
    <div class="dr-row"><div class="dr-left"><div class="dr-dot" style="background:#a78bfa"></div>3 in a row</div><div class="dr-val">50 pts</div></div>
    <div class="dr-row"><div class="dr-left"><div class="dr-dot" style="background:#60d0ff"></div>4 in a row</div><div class="dr-val">90 pts</div></div>
    <div class="dr-row"><div class="dr-left"><div class="dr-dot" style="background:#ffd700"></div>5 in a row</div><div class="dr-val">150 pts</div></div>
    <div class="dr-row"><div class="dr-left">ğŸ”¥ Combo multiplier</div><div class="dr-val gold">+25% each</div></div>
    <div class="dr-row"><div class="dr-left">â›“ Chain reaction</div><div class="dr-val gold">+35% each</div></div>
  </div>
  <div class="dr-section">
    <div class="dr-head">Elemental Reactions</div>
    <div class="dr-row"><div class="dr-left">ğŸ”¥+â„ï¸ Melt</div><div class="dr-val">+60 pts</div></div>
    <div class="dr-row"><div class="dr-left">ğŸ’§+âš¡ Shock</div><div class="dr-val">+75 pts</div></div>
    <div class="dr-row"><div class="dr-left">âš¡+ğŸ”¥ Ignite</div><div class="dr-val">+70 pts</div></div>
    <div class="dr-row"><div class="dr-left">ğŸŒ¿+ğŸ’§ Absorb</div><div class="dr-val">+55 pts</div></div>
    <div class="dr-row"><div class="dr-left">ğŸ”¥+ğŸŒ¿ Wildfire</div><div class="dr-val">+100 pts</div></div>
    <div class="dr-row"><div class="dr-left">ğŸ”®+any Phantom</div><div class="dr-val">+80 pts</div></div>
  </div>
  <div class="dr-section">
    <div class="dr-head">Rune Gems âœ¦</div>
    <div class="dr-row"><div class="dr-left">âœ… Correct answer</div><div class="dr-val gold">+big bonus + 2 moves</div></div>
    <div class="dr-row"><div class="dr-left">âŒ Wrong / timeout</div><div class="dr-val red">âˆ’moves</div></div>
  </div>
</div>

<!-- â”€â”€ TOPIC SELECT â”€â”€ -->
<div id="topic-screen">
  <div class="topic-card">
    <h1>âœ¦ Crystalline âœ¦</h1>
    <div class="subtitle">Elemental Knowledge Puzzle</div>
    <div class="how">
      Match gems <strong>horizontally &amp; vertically</strong> to score points. As you earn score, <strong>Rune Gems âœ¦</strong> appear on the board. Match one to unlock an <span class="badge">âœ¦ AI Question</span> â€” unique every session, harder every level. Answer correctly for bonus points and extra moves!
    </div>
    <div class="topic-grid" id="topic-grid"></div>
    <button class="btn btn-gold" onclick="confirmTopic()" id="start-btn" disabled>Choose a Topic to Begin âœ¦</button>

    <!-- Scoring guide on home screen -->
    <div class="score-guide">
      <h3>ğŸ“Š Scoring Guide</h3>
      <div class="sg-cols">
        <div class="sg-row"><div class="sg-left"><div class="sg-dot" style="background:#a78bfa"></div>3 in a row</div><span class="sg-val">50 pts</span></div>
        <div class="sg-row"><div class="sg-left"><div class="sg-dot" style="background:#60d0ff"></div>4 in a row</div><span class="sg-val">90 pts</span></div>
        <div class="sg-row"><div class="sg-left"><div class="sg-dot" style="background:#ffd700"></div>5 in a row</div><span class="sg-val">150 pts</span></div>
        <div class="sg-row"><div class="sg-left">ğŸ”¥ Combo</div><span class="sg-val">+25% ea</span></div>
        <div class="sg-row"><div class="sg-left">ğŸ”¥+â„ï¸ Melt</div><span class="sg-val">+60 pts</span></div>
        <div class="sg-row"><div class="sg-left">ğŸ’§+âš¡ Shock</div><span class="sg-val">+75 pts</span></div>
        <div class="sg-row"><div class="sg-left">âš¡+ğŸ”¥ Ignite</div><span class="sg-val">+70 pts</span></div>
        <div class="sg-row"><div class="sg-left">ğŸŒ¿+ğŸ’§ Absorb</div><span class="sg-val">+55 pts</span></div>
        <div class="sg-row"><div class="sg-left">ğŸ”¥+ğŸŒ¿ Wildfire</div><span class="sg-val">+100 pts</span></div>
        <div class="sg-row"><div class="sg-left">ğŸ”® Phantom</div><span class="sg-val">+80 pts</span></div>
        <div class="sg-row"><div class="sg-left">âœ¦ Rune correct</div><span class="sg-val gold">Big bonus!</span></div>
        <div class="sg-row"><div class="sg-left">âœ¦ Rune wrong</div><span class="sg-val red">âˆ’moves</span></div>
      </div>
    </div>
  </div>
</div>

<!-- â”€â”€ GAME SCREEN â”€â”€ -->
<div id="game-screen" class="hidden">
<div id="app">
  <header>
    <h1>âœ¦ Crystalline âœ¦</h1>
    <div style="display:flex;align-items:center;justify-content:center;gap:5px;margin-top:2px;flex-wrap:wrap;">
      <div id="topic-badge"></div>
      <div id="ai-badge"><div class="ai-dot"></div>AI Questions</div>
    </div>
  </header>

  <div id="hud">
    <div class="hud-card"><span class="hud-label">Score</span><span class="hud-value" id="score-display">0</span></div>
    <div class="hud-card"><span class="hud-label">Level</span><span class="hud-value" id="level-display">1</span></div>
    <div class="hud-card"><span class="hud-label">Best</span><span class="hud-value" id="best-display">0</span></div>
    <div class="hud-card"><span class="hud-label">Runes âœ¦</span><span class="hud-value" id="rune-display" style="color:#ffd700">0</span></div>
    <div id="combo-display">ğŸ”¥ COMBO x<span id="combo-num">0</span></div>
  </div>

  <div id="status-bar">
    <div id="ai-loading"><div class="spin"></div><span id="ai-loading-text">Generating questionsâ€¦</span></div>
    <div id="rune-alert"><div class="pulse"></div><span id="rune-alert-text">A Rune Gem appeared!</span></div>
  </div>

  <div id="moves-bar-wrap">
    <div id="moves-label"><span>Moves Remaining</span><span id="moves-count">30 / 30</span></div>
    <div id="moves-bar-bg"><div id="moves-bar-fill"></div></div>
  </div>

  <div id="game-area">
    <!-- Left panel: elements + match scores -->
    <div class="side-panel">
      <h3>Elements</h3>
      <div style="display:flex;flex-direction:column;gap:4px;">
        <div class="elem-row"><div class="elem-left"><div class="elem-dot" style="background:#ff4e1a"></div>Fire ğŸ”¥</div><span class="elem-pts">50pt</span></div>
        <div class="elem-row"><div class="elem-left"><div class="elem-dot" style="background:#00c8ff"></div>Water ğŸ’§</div><span class="elem-pts">50pt</span></div>
        <div class="elem-row"><div class="elem-left"><div class="elem-dot" style="background:#a8f0ff"></div>Ice â„ï¸</div><span class="elem-pts">50pt</span></div>
        <div class="elem-row"><div class="elem-left"><div class="elem-dot" style="background:#ffe033"></div>Lightning âš¡</div><span class="elem-pts">50pt</span></div>
        <div class="elem-row"><div class="elem-left"><div class="elem-dot" style="background:#7fff5e"></div>Earth ğŸŒ¿</div><span class="elem-pts">50pt</span></div>
        <div class="elem-row"><div class="elem-left"><div class="elem-dot" style="background:#cc44ff"></div>Shadow ğŸ”®</div><span class="elem-pts">50pt</span></div>
      </div>
      <h3>Match Bonus</h3>
      <div style="display:flex;flex-direction:column;gap:4px;">
        <div class="elem-row"><div class="elem-left">3 gems</div><span class="elem-pts">50pt</span></div>
        <div class="elem-row"><div class="elem-left">4 gems</div><span class="elem-pts">90pt</span></div>
        <div class="elem-row"><div class="elem-left">5 gems</div><span class="elem-pts">150pt</span></div>
        <div class="elem-row"><div class="elem-left">Combo Ã—</div><span class="elem-pts" style="color:#ffd700">+25%</span></div>
      </div>
      <h3>Rune âœ¦</h3>
      <div class="elem-row"><div class="elem-left"><div class="elem-dot" style="background:#ffd700;box-shadow:0 0 5px #ffd700"></div><span style="color:#ffd700;font-size:.6rem;">Knowledge</span></div></div>
      <div style="font-size:.57rem;color:var(--dim);line-height:1.5;">Match to trigger AI quiz!</div>
      <div>
        <div style="font-family:'Rajdhani',sans-serif;font-size:.52rem;letter-spacing:.13em;text-transform:uppercase;color:#ffd700;margin-bottom:2px;">Next Rune</div>
        <div id="rune-bar-bg"><div id="rune-bar-fill"></div></div>
        <div id="rune-count-info" style="font-family:'Rajdhani',sans-serif;font-size:.52rem;color:var(--dim);margin-top:2px;"></div>
      </div>
    </div>

    <!-- Canvas -->
    <div id="canvas-wrapper">
      <canvas id="game-canvas"></canvas>
      <canvas id="particle-canvas"></canvas>
      <div id="canvas-paused">
        <p>â¸ Paused</p>
        <span>Tap Resume to continue</span>
      </div>
    </div>

    <!-- Right panel: difficulty + reactions + stats -->
    <div class="side-panel">
      <h3>Difficulty</h3>
      <div id="difficulty-panel" style="display:flex;flex-direction:column;gap:4px;"></div>
      <h3 style="margin-top:3px;">Reactions</h3>
      <div style="display:flex;flex-direction:column;gap:3px;">
        <div class="elem-row"><div class="elem-left">ğŸ”¥+â„ï¸ Melt</div><span class="elem-pts">+60</span></div>
        <div class="elem-row"><div class="elem-left">ğŸ’§+âš¡ Shock</div><span class="elem-pts">+75</span></div>
        <div class="elem-row"><div class="elem-left">âš¡+ğŸ”¥ Ignite</div><span class="elem-pts">+70</span></div>
        <div class="elem-row"><div class="elem-left">ğŸŒ¿+ğŸ’§ Absorb</div><span class="elem-pts">+55</span></div>
        <div class="elem-row"><div class="elem-left">ğŸ”¥+ğŸŒ¿ Wild</div><span class="elem-pts">+100</span></div>
        <div class="elem-row"><div class="elem-left">ğŸ”® Phantom</div><span class="elem-pts">+80</span></div>
      </div>
      <h3 style="margin-top:3px;">Stats</h3>
      <div style="display:flex;flex-direction:column;gap:3px;">
        <div class="stat-row"><span class="stat-key">Questions</span><span class="stat-val" id="stat-q">0</span></div>
        <div class="stat-row"><span class="stat-key">Correct</span><span class="stat-val gold" id="stat-c">0</span></div>
        <div class="stat-row"><span class="stat-key">Accuracy</span><span class="stat-val" id="stat-a">â€”</span></div>
        <div class="stat-row"><span class="stat-key">Best Combo</span><span class="stat-val" id="stat-bc">0</span></div>
      </div>
    </div>
  </div>

  <div id="level-strip">
    Target: <span id="target-display">1,200</span> pts &nbsp;|&nbsp;
    Runes: <span class="gold" id="runes-on-board">0</span> &nbsp;|&nbsp;
    <span id="objective-display">Novice</span>
  </div>
</div>
</div>

<!-- â”€â”€ PAUSE OVERLAY â€” clearly separated buttons â”€â”€ -->
<div id="pause-overlay">
  <div class="pause-card">
    <h2>â¸ Paused</h2>
    <p>Your game is safe.<br>Score and moves are preserved.</p>
    <div class="pause-btns">
      <button class="btn btn-gold" onclick="togglePause()">â–¶ Resume Game</button>
      <div class="pause-divider"></div>
      <button class="btn btn-ghost" onclick="restartGame()">â†º Restart Level</button>
      <button class="btn btn-red" onclick="confirmGoHome()">ğŸ  Go to Home</button>
    </div>
  </div>
</div>

<!-- â”€â”€ CONFIRM GO HOME â”€â”€ -->
<div class="overlay" id="confirm-home-overlay">
  <div class="overlay-card">
    <h2>Go Home?</h2>
    <p>Your current game progress will be lost.</p>
    <div class="overlay-btns">
      <button class="btn btn-red" onclick="goToTopicSelect()">Yes, go home</button>
      <button class="btn btn-ghost" onclick="cancelGoHome()">Cancel</button>
    </div>
  </div>
</div>

<!-- â”€â”€ QUESTION OVERLAY â”€â”€ -->
<div id="question-overlay">
  <div class="q-card">
    <div class="q-rune-display" id="q-rune-letter">?</div>
    <h3>Rune Challenge âœ¦</h3>
    <div class="q-meta">
      <span class="q-topic-badge" id="q-topic-name"></span>
      <span class="q-diff-badge" id="q-diff-badge"></span>
    </div>
    <div class="q-timer-bar-bg"><div class="q-timer-bar" id="q-timer-bar"></div></div>
    <div class="q-question" id="q-question-text"></div>
    <div class="q-choices" id="q-choices"></div>
    <div class="q-feedback" id="q-feedback"></div>
    <div class="q-explanation" id="q-explanation"></div>
    <div class="q-stakes">âœ… Correct: <span class="good">+<span id="q-bonus">500</span> pts &amp; +2 moves</span> &nbsp;|&nbsp; âŒ Wrong: <span class="bad">âˆ’<span id="q-penalty">2</span> moves</span></div>
    <div class="q-source" id="q-source"></div>
  </div>
</div>

<!-- â”€â”€ LEVEL COMPLETE â”€â”€ -->
<div class="overlay" id="level-overlay">
  <div class="overlay-card">
    <h2 id="level-title">Level Complete!</h2>
    <div class="stars-row"><span class="star" style="--d:0s">â­</span><span class="star" style="--d:.15s">â­</span><span class="star" style="--d:.3s">â­</span></div>
    <span class="big-score" id="level-score">0</span>
    <div class="score-breakdown" id="score-breakdown"></div>
    <p id="level-feedback"></p>
    <div class="overlay-btns">
      <button class="btn btn-gold" onclick="nextLevel()">Next Level â¤</button>
      <button class="btn btn-ghost" onclick="restartGame()">â†º Restart</button>
      <button class="btn btn-red" onclick="goToTopicSelect()">ğŸ  Home</button>
    </div>
  </div>
</div>

<!-- â”€â”€ GAME OVER â”€â”€ -->
<div class="overlay" id="gameover-overlay">
  <div class="overlay-card">
    <h2>Game Over</h2>
    <span class="big-score" id="final-score">0</span>
    <div class="score-breakdown" id="go-breakdown"></div>
    <p id="gameover-feedback"></p>
    <div class="overlay-btns">
      <button class="btn btn-purple" onclick="restartGame()">Play Again âœ¦</button>
      <button class="btn btn-red" onclick="goToTopicSelect()">ğŸ  Home</button>
    </div>
  </div>
</div>

<script src="game.js"></script>
</body>
</html>