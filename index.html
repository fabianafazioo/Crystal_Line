<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‚ú® Crystalline ‚Äî Elemental Gem Puzzle</title>
<link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@400;700;900&family=Raleway:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
  :root {
    --fire:   #ff4e1a;
    --water:  #00c8ff;
    --ice:    #a8f0ff;
    --lightning: #ffe033;
    --earth:  #7fff5e;
    --shadow: #cc44ff;
    --bg-deep: #0a0612;
    --bg-mid:  #130924;
    --panel:   rgba(255,255,255,0.04);
    --border:  rgba(255,255,255,0.10);
    --text:    #f0e8ff;
    --text-dim: rgba(240,232,255,0.45);
    --glow-size: 18px;
  }

  * { margin:0; padding:0; box-sizing:border-box; }

  body {
    background: var(--bg-deep);
    color: var(--text);
    font-family: 'Raleway', sans-serif;
    min-height: 100vh;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    position: relative;
  }

  /* ‚îÄ‚îÄ Animated starfield background ‚îÄ‚îÄ */
  #bg-canvas {
    position: fixed;
    inset: 0;
    z-index: 0;
    pointer-events: none;
  }

  /* ‚îÄ‚îÄ Layout ‚îÄ‚îÄ */
  #app {
    position: relative;
    z-index: 10;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 10px;
    width: 100vw;
    max-width: 960px;
    padding: 10px;
  }

  /* ‚îÄ‚îÄ Header ‚îÄ‚îÄ */
  header {
    text-align: center;
    user-select: none;
  }
  header h1 {
    font-family: 'Cinzel Decorative', serif;
    font-size: clamp(1.4rem, 3.5vw, 2.4rem);
    font-weight: 900;
    letter-spacing: 0.12em;
    background: linear-gradient(135deg, #e8c6ff 0%, #a78bfa 40%, #60d0ff 80%, #ffe066 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    filter: drop-shadow(0 0 20px rgba(167,139,250,0.6));
    text-transform: uppercase;
  }
  header p {
    font-size: 0.75rem;
    letter-spacing: 0.3em;
    color: var(--text-dim);
    text-transform: uppercase;
    margin-top: 2px;
  }

  /* ‚îÄ‚îÄ HUD bar ‚îÄ‚îÄ */
  #hud {
    display: flex;
    gap: 12px;
    align-items: center;
    justify-content: center;
    flex-wrap: wrap;
    width: 100%;
  }

  .hud-card {
    background: var(--panel);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 8px 18px;
    display: flex;
    flex-direction: column;
    align-items: center;
    min-width: 80px;
    backdrop-filter: blur(12px);
    transition: border-color 0.3s;
  }
  .hud-card:hover { border-color: rgba(167,139,250,0.4); }
  .hud-label {
    font-size: 0.6rem;
    letter-spacing: 0.25em;
    text-transform: uppercase;
    color: var(--text-dim);
  }
  .hud-value {
    font-family: 'Cinzel Decorative', serif;
    font-size: 1.3rem;
    font-weight: 700;
    color: #e8c6ff;
    line-height: 1;
    transition: transform 0.15s;
  }
  .hud-value.pop { transform: scale(1.35); color: #ffe066; }

  #combo-display {
    font-size: 0.8rem;
    letter-spacing: 0.15em;
    padding: 6px 16px;
    border-radius: 999px;
    background: linear-gradient(90deg, rgba(255,78,26,0.2), rgba(167,139,250,0.2));
    border: 1px solid rgba(255,224,51,0.3);
    color: #ffe066;
    opacity: 0;
    transition: opacity 0.3s, transform 0.3s;
    transform: translateY(4px);
  }
  #combo-display.visible { opacity: 1; transform: translateY(0); }

  /* ‚îÄ‚îÄ Main game area ‚îÄ‚îÄ */
  #game-area {
    display: flex;
    gap: 14px;
    align-items: flex-start;
    justify-content: center;
    width: 100%;
  }

  /* ‚îÄ‚îÄ Side panels ‚îÄ‚îÄ */
  .side-panel {
    background: var(--panel);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 14px 12px;
    width: 140px;
    flex-shrink: 0;
    backdrop-filter: blur(12px);
    display: flex;
    flex-direction: column;
    gap: 10px;
  }
  .side-panel h3 {
    font-family: 'Cinzel Decorative', serif;
    font-size: 0.6rem;
    letter-spacing: 0.2em;
    text-transform: uppercase;
    color: var(--text-dim);
    text-align: center;
    border-bottom: 1px solid var(--border);
    padding-bottom: 6px;
  }

  .element-legend {
    display: flex;
    flex-direction: column;
    gap: 6px;
  }
  .elem-row {
    display: flex;
    align-items: center;
    gap: 7px;
    font-size: 0.68rem;
    color: var(--text-dim);
  }
  .elem-dot {
    width: 14px; height: 14px;
    border-radius: 50%;
    flex-shrink: 0;
    box-shadow: 0 0 6px currentColor;
  }

  .reaction-list {
    display: flex;
    flex-direction: column;
    gap: 5px;
  }
  .reaction-item {
    font-size: 0.62rem;
    color: var(--text-dim);
    line-height: 1.4;
    padding: 4px 6px;
    border-radius: 6px;
    background: rgba(255,255,255,0.03);
    border-left: 2px solid;
  }
  .reaction-item.fire-r  { border-color: var(--fire);      color: #ffaa88; }
  .reaction-item.water-r { border-color: var(--water);     color: #88ddff; }
  .reaction-item.light-r { border-color: var(--lightning); color: #ffee88; }
  .reaction-item.earth-r { border-color: var(--earth);     color: #aaffaa; }
  .reaction-item.shadow-r{ border-color: var(--shadow);    color: #dd99ff; }

  /* ‚îÄ‚îÄ Canvas wrapper ‚îÄ‚îÄ */
  #canvas-wrapper {
    position: relative;
    flex-shrink: 0;
    border-radius: 20px;
    overflow: hidden;
    box-shadow:
      0 0 0 1px rgba(255,255,255,0.08),
      0 0 60px rgba(100,60,180,0.4),
      0 0 120px rgba(60,20,120,0.3),
      inset 0 0 40px rgba(0,0,0,0.5);
  }
  #canvas-wrapper::before {
    content: '';
    position: absolute;
    inset: 0;
    border-radius: 20px;
    border: 1px solid rgba(167,139,250,0.25);
    pointer-events: none;
    z-index: 20;
  }

  #game-canvas {
    display: block;
    cursor: pointer;
    border-radius: 20px;
  }

  /* ‚îÄ‚îÄ Particle canvas (overlay) ‚îÄ‚îÄ */
  #particle-canvas {
    position: absolute;
    inset: 0;
    pointer-events: none;
    border-radius: 20px;
    z-index: 15;
  }

  /* ‚îÄ‚îÄ Moves meter ‚îÄ‚îÄ */
  #moves-bar-wrap {
    width: 100%;
  }
  #moves-label {
    display: flex;
    justify-content: space-between;
    font-size: 0.65rem;
    color: var(--text-dim);
    letter-spacing: 0.15em;
    text-transform: uppercase;
    margin-bottom: 5px;
  }
  #moves-bar-bg {
    width: 100%;
    height: 6px;
    background: rgba(255,255,255,0.06);
    border-radius: 99px;
    overflow: hidden;
  }
  #moves-bar-fill {
    height: 100%;
    border-radius: 99px;
    background: linear-gradient(90deg, #a78bfa, #60d0ff);
    box-shadow: 0 0 8px rgba(96,208,255,0.6);
    transition: width 0.4s ease, background 0.4s;
  }

  /* ‚îÄ‚îÄ Level info strip ‚îÄ‚îÄ */
  #level-strip {
    display: flex;
    gap: 16px;
    align-items: center;
    justify-content: center;
    font-size: 0.7rem;
    color: var(--text-dim);
    letter-spacing: 0.2em;
    text-transform: uppercase;
  }
  #level-strip span { color: #c4b5fd; font-weight: 600; }

  /* ‚îÄ‚îÄ Overlay screens ‚îÄ‚îÄ */
  .overlay {
    position: fixed;
    inset: 0;
    z-index: 100;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(5,2,14,0.88);
    backdrop-filter: blur(16px);
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.4s;
  }
  .overlay.active { opacity: 1; pointer-events: all; }

  .overlay-card {
    background: linear-gradient(135deg, rgba(30,12,60,0.95), rgba(10,6,20,0.98));
    border: 1px solid rgba(167,139,250,0.3);
    border-radius: 24px;
    padding: 44px 48px;
    text-align: center;
    max-width: 420px;
    width: 90%;
    box-shadow: 0 0 80px rgba(100,60,180,0.5), 0 0 160px rgba(60,20,120,0.3);
    transform: translateY(20px);
    transition: transform 0.4s;
  }
  .overlay.active .overlay-card { transform: translateY(0); }

  .overlay-card h2 {
    font-family: 'Cinzel Decorative', serif;
    font-size: 1.8rem;
    background: linear-gradient(135deg, #e8c6ff, #a78bfa, #60d0ff);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-bottom: 10px;
  }
  .overlay-card p {
    color: var(--text-dim);
    font-size: 0.85rem;
    letter-spacing: 0.1em;
    line-height: 1.7;
    margin-bottom: 8px;
  }
  .overlay-card .big-score {
    font-family: 'Cinzel Decorative', serif;
    font-size: 3rem;
    color: #ffe066;
    filter: drop-shadow(0 0 20px rgba(255,224,51,0.6));
    margin: 14px 0;
    display: block;
  }

  .btn {
    display: inline-block;
    margin-top: 20px;
    padding: 12px 32px;
    border-radius: 999px;
    border: none;
    font-family: 'Cinzel Decorative', serif;
    font-size: 0.8rem;
    letter-spacing: 0.15em;
    cursor: pointer;
    transition: transform 0.2s, box-shadow 0.2s, filter 0.2s;
    text-transform: uppercase;
  }
  .btn:hover { transform: scale(1.06); filter: brightness(1.15); }
  .btn:active { transform: scale(0.97); }

  .btn-primary {
    background: linear-gradient(135deg, #7c3aed, #a855f7, #5b21b6);
    color: #fff;
    box-shadow: 0 0 24px rgba(124,58,237,0.5);
  }
  .btn-secondary {
    background: transparent;
    border: 1px solid rgba(167,139,250,0.4);
    color: #c4b5fd;
    margin-left: 10px;
  }

  .stars-row {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin: 14px 0;
  }
  .star {
    font-size: 2rem;
    opacity: 0.2;
    transition: opacity 0.3s, transform 0.3s;
    transition-delay: var(--d, 0s);
  }
  .star.lit { opacity: 1; transform: scale(1.2) rotate(10deg); }

  /* ‚îÄ‚îÄ Floating score popups ‚îÄ‚îÄ */
  .score-popup {
    position: absolute;
    pointer-events: none;
    font-family: 'Cinzel Decorative', serif;
    font-weight: 700;
    font-size: 1rem;
    text-shadow: 0 0 10px currentColor;
    animation: floatUp 1.1s forwards ease-out;
    z-index: 50;
    white-space: nowrap;
  }
  @keyframes floatUp {
    0%   { opacity: 1; transform: translateY(0) scale(1); }
    60%  { opacity: 1; transform: translateY(-40px) scale(1.1); }
    100% { opacity: 0; transform: translateY(-70px) scale(0.9); }
  }

  /* ‚îÄ‚îÄ Responsive ‚îÄ‚îÄ */
  @media (max-width: 700px) {
    .side-panel { display: none; }
    #game-area { flex-direction: column; align-items: center; }
  }
</style>
</head>
<body>

<canvas id="bg-canvas"></canvas>

<div id="app">
  <header>
    <h1>‚ú¶ Crystalline ‚ú¶</h1>
    <p>Elemental Gem Puzzle</p>
  </header>

  <!-- HUD -->
  <div id="hud">
    <div class="hud-card">
      <span class="hud-label">Score</span>
      <span class="hud-value" id="score-display">0</span>
    </div>
    <div class="hud-card">
      <span class="hud-label">Level</span>
      <span class="hud-value" id="level-display">1</span>
    </div>
    <div class="hud-card">
      <span class="hud-label">Best</span>
      <span class="hud-value" id="best-display">0</span>
    </div>
    <div id="combo-display">üî• COMBO x<span id="combo-num">0</span></div>
  </div>

  <!-- Moves bar -->
  <div id="moves-bar-wrap" style="max-width:500px;width:100%;">
    <div id="moves-label">
      <span>Moves</span>
      <span id="moves-count">20 / 20</span>
    </div>
    <div id="moves-bar-bg"><div id="moves-bar-fill" style="width:100%"></div></div>
  </div>

  <!-- Main game area -->
  <div id="game-area">

    <!-- Left panel: elements -->
    <div class="side-panel">
      <h3>Elements</h3>
      <div class="element-legend">
        <div class="elem-row"><div class="elem-dot" style="background:var(--fire);color:var(--fire)"></div>Fire</div>
        <div class="elem-row"><div class="elem-dot" style="background:var(--water);color:var(--water)"></div>Water</div>
        <div class="elem-row"><div class="elem-dot" style="background:var(--ice);color:var(--ice)"></div>Ice</div>
        <div class="elem-row"><div class="elem-dot" style="background:var(--lightning);color:var(--lightning)"></div>Lightning</div>
        <div class="elem-row"><div class="elem-dot" style="background:var(--earth);color:var(--earth)"></div>Earth</div>
        <div class="elem-row"><div class="elem-dot" style="background:var(--shadow);color:var(--shadow)"></div>Shadow</div>
      </div>
    </div>

    <!-- Game canvas -->
    <div id="canvas-wrapper">
      <canvas id="game-canvas"></canvas>
      <canvas id="particle-canvas"></canvas>
    </div>

    <!-- Right panel: reactions -->
    <div class="side-panel">
      <h3>Reactions</h3>
      <div class="reaction-list">
        <div class="reaction-item fire-r">üî• Fire<br>melts ‚ùÑÔ∏è Ice</div>
        <div class="reaction-item water-r">üíß Water<br>conducts ‚ö°</div>
        <div class="reaction-item light-r">‚ö° Lightning<br>ignites üî•</div>
        <div class="reaction-item earth-r">üåø Earth<br>absorbs üíß</div>
        <div class="reaction-item shadow-r">üîÆ Shadow<br>copies all</div>
        <div class="reaction-item fire-r">üî•+üåø<br>= Wildfire!</div>
      </div>
    </div>

  </div>

  <!-- Level strip -->
  <div id="level-strip">
    Target: <span id="target-display">500</span> pts
    &nbsp;|&nbsp;
    Objective: <span id="objective-display">Clear fire gems</span>
  </div>
</div>

<!-- Overlays -->
<div class="overlay active" id="start-overlay">
  <div class="overlay-card">
    <h2>‚ú¶ Crystalline ‚ú¶</h2>
    <p>Match 3+ elemental gems to trigger chain reactions.<br>
    Combine elements for massive combos & bonus points.</p>
    <div style="margin:16px 0;display:flex;flex-wrap:wrap;gap:8px;justify-content:center;font-size:0.75rem;color:#c4b5fd;">
      <span>üî• Fire</span><span>üíß Water</span><span>‚ùÑÔ∏è Ice</span>
      <span>‚ö° Lightning</span><span>üåø Earth</span><span>üîÆ Shadow</span>
    </div>
    <p style="color:#a78bfa;font-size:0.78rem;">Click a gem, then click an adjacent gem to swap.<br>Chain reactions earn massive bonuses!</p>
    <button class="btn btn-primary" onclick="startGame()">Begin Journey ‚ú®</button>
  </div>
</div>

<div class="overlay" id="level-overlay">
  <div class="overlay-card">
    <h2 id="level-title">Level Complete!</h2>
    <div class="stars-row">
      <span class="star" style="--d:0s">‚≠ê</span>
      <span class="star" style="--d:0.15s">‚≠ê</span>
      <span class="star" style="--d:0.3s">‚≠ê</span>
    </div>
    <p>Score</p>
    <span class="big-score" id="level-score">0</span>
    <p id="level-feedback">Excellent work!</p>
    <button class="btn btn-primary" onclick="nextLevel()">Next Level ‚û§</button>
    <button class="btn btn-secondary" onclick="restartGame()">Restart</button>
  </div>
</div>

<div class="overlay" id="gameover-overlay">
  <div class="overlay-card">
    <h2>Game Over</h2>
    <p>Out of moves! Final Score:</p>
    <span class="big-score" id="final-score">0</span>
    <p id="gameover-feedback">Keep practising!</p>
    <button class="btn btn-primary" onclick="restartGame()">Play Again ‚ú®</button>
  </div>
</div>

<script src="game.js"></script>
</body>
</html>